<!DOCTYPE html>
<html>
<head>
    <title>Mapa Klub√≥w - Zamojszczyzna</title>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="pilka1.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link href="https://cdn.jsdelivr.net/npm/leaflet.fullscreen@4.0.0/Control.FullScreen.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    <style>
        html, body, #map { width: 100%; height: 100%; padding: 0; margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
		.custom-map-btn {
			background-color: #fff;
			border: 2px solid rgba(0,0,0,0.2);
			border-radius: 4px;
			width: auto !important;
			min-width: 100px;
			display: block;
			padding: 8px 15px !important;
			font-weight: 600;
			font-size: 13px !important;
			cursor: pointer;
			text-align: center;
			margin-bottom: 5px !important;
			white-space: nowrap;
			color: #333;
		}

		.btn-okr { border-left: 5px solid #2e7d32; color: #2e7d32 !important; } /* Zielony dla Okrƒôg√≥wki */
		.btn-aklasa { border-left: 5px solid #d32f2f; color: #d32f2f !important; } /* Czerwony dla A Klasy */

		.custom-map-btn:hover { background-color: #f4f4f4; }
		#map-title {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 25px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-size: 16px;
            font-weight: 700;
            color: #2c3e50;
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
            pointer-events: none;
        }

        #btnTrasa {
            position: absolute;
            bottom: 30px;
            right: 10px;
            z-index: 1000;
            padding: 10px 20px;
            background: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        #btnTrasa:hover { transform: scale(1.05); background-color: #f9f9f9; }
        #btnTrasa.active { background-color: #ffebee; color: #c62828; border: 2px solid #c62828; }

        .search-container {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: 320px;
            max-width: 90%;
            background: #fff;
            border-radius: 24px; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            padding: 2px;
        }

        /* STYL PINEZKI - USUNIƒòTO STA≈ÅY KOLOR */
		.custom-pin {
		    width: 30px;
		    height: 30px;
		    border-radius: 50% 50% 50% 0;
		    position: absolute;
		    transform: rotate(-45deg);
		    left: 50%;
		    top: 50%;
		    margin: -15px 0 0 -15px;
		    border: 2px solid #fff;
		    box-shadow: 1px 1px 4px rgba(0,0,0,0.5);
		}

        /* KOLORY DLA LIG */
        .pin-okr { background: #2e7d32; }    /* Zielony */
        .pin-aklasa { background: #d32f2f; } /* Czerwony */

        .search-container:hover, .search-container:focus-within { box-shadow: 0 4px 12px rgba(0,0,0,0.4); width: 330px; }
        #search-input { width: 100%; height: 40px; border: none; outline: none; background: transparent; font-size: 16px; padding-left: 20px; border-radius: 24px; }
        #search-results { display: none; position: absolute; top: 50px; left: 0; right: 0; background: white; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); max-height: 250px; overflow-y: auto; z-index: 1001; padding: 5px 0; }
        .search-result-item { padding: 12px 20px; cursor: pointer; font-size: 14px; color: #444; border-bottom: 1px solid #f0f0f0; transition: background 0.1s; display: flex; align-items: center; }
        .search-result-item::before { content: '‚öΩ'; margin-right: 10px; font-size: 12px; opacity: 0.7; }
        .search-result-item:hover { background-color: #fce4ec; color: #000; font-weight: 500; }

        #side-panel { position: fixed; top: 0; right: -450px; width: 450px; max-width: 100%; height: 100%; background: white; z-index: 2000; box-shadow: -5px 0 15px rgba(0,0,0,0.2); transition: right 0.3s ease-in-out; padding: 25px; box-sizing: border-box; display: flex; flex-direction: column; }
        #side-panel.open { right: 0; }
        .close-btn { align-self: flex-end; font-size: 30px; cursor: pointer; background: none; border: none; color: #888; margin-bottom: 10px; }
        .close-btn:hover { color: #d32f2f; }
        #table-content { flex-grow: 1; overflow-y: auto; }
        #table-content table { width: 100%; border-collapse: collapse; font-size: 14px; }
        #table-content th { background-color: #222; color: white; padding: 10px; position: sticky; top: 0; }
        #table-content td { border-bottom: 1px solid #eee; padding: 10px; text-align: center; }
        #table-content td:nth-child(2) { text-align: left; font-weight: 600; }
        .points-cell { background-color: #ffebee; color: #c62828; font-weight: bold; }
        
        .leaflet-popup-content-wrapper { border-radius: 8px; }
        .leaflet-popup-content img { max-width: 120px; display: block; margin: 0 auto 10px; }
        .leaflet-popup-content h4 { text-align: center; margin: 0 0 5px; font-size: 18px; color: #333; }
    </style>
</head>

<body>
    <div id="map-title">‚öΩ Mapa Klub√≥w Zamojszczyzny</div>
    <button id="btnTrasa">üìè Zmierz trasƒô</button>
	<div class="search-container">
        <input type="text" id="search-input" placeholder="üîç Szukaj klubu...">
        <div id="search-results"></div>
	</div>
    <div id="map"></div>
    <div id="side-panel">
        <button class="close-btn" onclick="closePanel()">√ó</button>
        <h3 id="panel-title" style="margin-top: 0;">Tabela Ligowa</h3>
        <div id="table-content"><p style="text-align: center; color: #666;">Wybierz ligƒô z mapy.</p></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.fullscreen@4.0.0/Control.FullScreen.min.js"></script>
	<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

    <script>
        var urlOkregowka = 'https://tabelka.szalachaszymon.workers.dev/?t='; 
        var urlAKlasa = 'https://tabelka2.szalachaszymon.workers.dev/?t='; 

        var mymap = L.map('map', { minZoom: 8, maxZoom: 20, fullscreenControl: true }).setView([50.60, 23.25], 9);
        var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap contributors' });
        var satelita = L.tileLayer('https://api.maptiler.com/maps/satellite/{z}/{x}/{y}@2x.jpg?key=m1zA7Cid129ZGwBsHJKc', { attribution: '¬© MapTiler' });
        osm.addTo(mymap);

        var baseMaps = { "Mapa drogowa": osm, "Satelita": satelita };
        L.control.layers(baseMaps).addTo(mymap);

        // Herby (Zmienne bez zmian)
        var imageUrlGraf = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTFeNGHzaotKd0YpUVN3y9_LRO7SXej81ZlPw&s';
        var imageUrlVictoria ='https://tmssl.akamaized.net//images/wappen/big/72580.png?lm=1705854612';
        var imageUrlBKS ='https://static.regiowyniki.pl/flags/7775.jpg';
        var imageUrlAndoria ='https://static.regiowyniki.pl/flags/1492.jpg';
        var imageUrlGryf ='https://static.regiowyniki.pl/flags/5974.jpg';
        var imageUrlHuragan ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTJhUZt28vley67DLf_ZJT7fFch_-4XL86JmA&s';
        var imageUrlPogon96 ='https://www.tomaszowlubelski.pl/asp/pliki/KLUBY_SPORTOWE/pogon_96.jpg';
        var imageUrlHuczwa ='https://lh4.googleusercontent.com/proxy/W9Mp6TklqDFg91CDh3oN3SAzXnI7g5bj_diEOE1sOlL4i92mKHdVDC7obgeZkxUyTG38o4jV9jjEGR4Ea_TE9QXlJRxgv4tRDKSFMNyxwRWL0VcEow6Smvgi'; 
        var imageUrlKorona ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRpkMa9R7s7flfi0y4Uv7I5GxARJzlsJi2jSA&s';
        var imageUrlOmega ='https://yt3.googleusercontent.com/ytc/AIdro_nDAN3__LeiRdMArpoIaBm7RC5oW33kczM6HPKO4Zl1Hg=s900-c-k-c0x00ffffff-no-rj'; 
        var imageUrlObsza ='https://static.regiowyniki.pl/flags/1493.jpg';
        var imageUrlSparta ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRE34iubuY96jG8Ltt8micBl6txqgc6AD4MFw&s';
        var imageUrlGrom = 'https://pbs.twimg.com/profile_images/835524454184796161/y9q7VWQy.jpg';
        var imageUrlOlimpiakos ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSxsKf838FdN9Dy-l9frMqcCjq3fi-QLLk15A&s';
        var imageUrlRoztocze ='https://static.regiowyniki.pl/flags/16.jpg';
        var imageUrlPotok ='https://static.regiowyniki.pl/flags/174.jpg';
		var imageUrlKrysztal ='https://static.regiowyniki.pl/flags/76.jpg';
        var imageUrlMetalowiec ='https://static.regiowyniki.pl/flags/169.jpg';
        var imageUrlOrkan ='https://static.regiowyniki.pl/flags/72.jpg';
        var imageUrlSokol ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSHqek-FQ-wiQ5p-JPf5ZzO8_7tzDKoQOdBzg&s';
        var imageUrlIgros ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQF_36XIm_btKdx7Zy2BBFTXxmS5ezq3A8_mQ&s';
        var imageUrlUnia ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS1iaLmfR6rQSInjU5PUFYsOhdKgJcNPR9ZyA&s';
        var imageUrlWlokniarz ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQlTODdKPIscBcPyZUfZM5-arMmt_j2UQv5sw&s';
        var imageUrlOlimpia ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS_1SHGLNKwthtzmccaw4U66FTaHFCZpDNeDA&s';
        var imageUrlLadaII ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTbJ7kEi3gRsdH4Eu-GGuMQhaBbWjtcM_17sg&s';
        var imageUrlSol ='https://static.regiowyniki.pl/flags/241.jpg';
        var imageUrlRelax ='https://static.regiowyniki.pl/flags/7961.jpg';
        var imageUrlDelta ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRZBOHsWknKi4VpkUgufSMLEe2VGbDh1zDlVA&s';
        var imageUrlOrion ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSkepS6f-3kMO8j2sOjlhJIw0UymUJBA0h64g&s';
        var imageUrlOstoja ='https://static.regiowyniki.pl/flags/66.jpg';

        // Baza danych z dopisanƒÖ ligƒÖ (league: 'okr' lub 'aklasa')
        var clubs = [
            { name: "Graf Chodywa≈Ñce", coords: [50.4115, 23.6338], img: imageUrlGraf, league: 'okr' },
            { name: "Victoria ≈Åukowa", coords: [50.374568, 22.931503], img: imageUrlVictoria, league: 'okr' },
            { name: "BKS Bodacz√≥w", coords: [50.71847223, 23.02866667], img: imageUrlBKS, league: 'okr' },
            { name: "Andoria Mircze", coords: [50.648271, 23.899800], img: imageUrlAndoria, league: 'okr' },
            { name: "Gryf Gmina Zamo≈õƒá", coords: [50.718213, 23.124866], img: imageUrlGryf, league: 'okr' }, 
            { name: "Huragan Hrubiesz√≥w", coords: [50.819063, 23.938947], img: imageUrlHuragan, league: 'okr' },
            { name: "Pogo≈Ñ 96 ≈Åaszcz√≥wka", coords: [50.433364, 23.441989], img: imageUrlPogon96, league: 'okr' },
            { name: "Huczwa Tyszowce", coords: [50.620059, 23.697150], img: imageUrlHuczwa, league: 'okr' },
            { name: "Korona ≈Åaszcz√≥w", coords: [50.531560, 23.730050], img: imageUrlKorona, league: 'okr' },
            { name: "Omega Stary Zamo≈õƒá", coords: [50.825782, 23.186894], img: imageUrlOmega, league: 'okr' },
            { name: "B≈Çƒôkitni Obsza", coords: [50.311309, 22.961576], img: imageUrlObsza, league: 'okr' },
            { name: "Sparta ≈Åabunie", coords: [50.651703, 23.371076], img: imageUrlSparta, league: 'okr' },
            { name: "Grom R√≥≈ºaniec", coords: [50.334694, 22.833663], img: imageUrlGrom, league: 'okr' },
            { name: "Olimpiakos Tarnogr√≥d", coords: [50.364096, 22.741249], img: imageUrlOlimpiakos, league: 'okr' },
            { name: "Roztocze Szczebrzeszyn", coords: [50.698140, 22.982636], img: imageUrlRoztocze, league: 'okr' },
            { name: "Potok Sitno", coords: [50.751519, 23.366493], img: imageUrlPotok, league: 'okr' },
			{ name: "Kryszta≈Ç Werbkowice", coords: [50.756550, 23.768443], img: imageUrlKrysztal, league: 'aklasa' },
            { name: "Metalowiec Goraj", coords: [50.722659, 22.672263], img: imageUrlMetalowiec, league: 'aklasa' },
            { name: "Orkan Be≈Ç≈ºec", coords: [50.387933, 23.437782], img: imageUrlOrkan, league: 'aklasa' },
            { name: "Sok√≥≈Ç Zwierzyniec", coords: [50.616298, 22.970837], img: imageUrlSokol, league: 'aklasa' },
            { name: "Igros Krasnobr√≥d", coords: [50.543778, 23.196106], img: imageUrlIgros, league: 'aklasa' },
            { name: "Unia Hrubiesz√≥w", coords: [50.806134, 23.879556], img: imageUrlUnia, league: 'aklasa' },
            { name: "W≈Ç√≥kniarz Frampol", coords: [50.661389, 22.668206], img: imageUrlWlokniarz, league: 'aklasa' },
            { name: "Olimpia MiƒÖczyn", coords: [50.735711, 23.498972], img: imageUrlOlimpia, league: 'aklasa' },
            { name: "≈Åada 1945 II Bi≈Çgoraj", coords: [50.544969, 22.717734], img: imageUrlLadaII, league: 'aklasa' },
            { name: "Olender S√≥l", coords: [50.495761, 22.620918], img: imageUrlSol, league: 'aklasa' },
            { name: "Relax Ksiƒô≈ºpol", coords: [50.425960, 22.736928], img: imageUrlRelax, league: 'aklasa' },
            { name: "Delta Nielisz", coords: [50.788498, 23.041930], img: imageUrlDelta, league: 'aklasa' },
            { name: "Orion Dere≈∫nia", coords: [50.504855, 22.704122], img: imageUrlOrion, league: 'aklasa' },
            { name: "Ostoja Skierbiesz√≥w", coords: [50.855185, 23.362913], img: imageUrlOstoja, league: 'aklasa' }
        ];

		var markersList = [];
        clubs.forEach(function(club) {
            // Wyb√≥r klasy koloru na podstawie ligi
            var pinColorClass = (club.league === 'okr') ? 'pin-okr' : 'pin-aklasa';

   			var pinIcon = L.divIcon({
		        className: 'custom-div-icon',
		        html: "<div class='custom-pin " + pinColorClass + "'></div>",
		        iconSize: [30, 30],
		        iconAnchor: [15, 30]
		    });

    	    var marker = L.marker(club.coords, { icon: pinIcon }).addTo(mymap);
            var popupContent = '<h4>' + club.name + '</h4>';
            
            if (club.img && club.img.length > 5) {
                popupContent += '<img src="' + club.img + '" alt="Herb ' + club.name + '" onerror="this.style.display=\'none\'">';
            } else {
                popupContent += '<p style="text-align:center; color:#666;">Brak zdjƒôcia</p>';
            }
            
            marker.bindPopup(popupContent, { closeButton: true, autoClose: false });
            marker.on('mouseover', function(e) { this.openPopup(); });
			marker.on('mouseout', function(e) { this.closePopup(); });
			markersList.push(marker);
        });

        // Obs≈Çuga tabel i worker√≥w (bez zmian)
        var currentLeague = null; 
        function closePanel() { var panel = document.getElementById('side-panel'); panel.classList.remove('open'); currentLeague = null; }

        function toggleTable(type) {
            var panel = document.getElementById('side-panel');
            var title = document.getElementById('panel-title');
            var isOpen = panel.classList.contains('open');
            var targetUrl = (type === 'okregowka') ? urlOkregowka : urlAKlasa;
            var targetTitle = (type === 'okregowka') ? 'Zamojska Klasa Okrƒôgowa' : 'Zamojska A Klasa';

            if (isOpen && currentLeague === type) { closePanel(); return; }
            panel.classList.add('open');
            title.innerText = targetTitle;
            currentLeague = type;
            loadTableData(targetUrl);
        }

        function loadTableData(urlBase) {
            var container = document.getElementById('table-content');
            if (!urlBase) { container.innerHTML = '<p style="color:red;">Link nie skonfigurowany.</p>'; return; }
            container.innerHTML = '<p style="text-align:center; color:#666;">Pobieranie danych...</p>';
            fetch(urlBase + new Date().getTime())
                .then(response => response.json()) 
                .then(data => {
                    let html = '<table><thead><tr><th>#</th><th style="text-align:left;">Dru≈ºyna</th><th>M</th><th>Pkt</th><th>Gole</th></tr></thead><tbody>';
                    data.forEach(club => {
                        html += `<tr><td>${club.rank}.</td><td>${club.team}</td><td>${club.matches}</td><td class="points-cell">${club.points}</td><td style="font-size:11px;">${club.goals}</td></tr>`;
                    });
                    html += '</tbody></table><p style="font-size:10px; text-align:right; color:#999;">Dane: 90minut.pl</p>';
                    container.innerHTML = html;
                }).catch(e => { container.innerHTML = '<p style="color:red;">B≈ÇƒÖd pobierania.</p>'; });
        }

        L.Control.TableButtonOkr = L.Control.extend({
            onAdd: function(map) {
                var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
                var button = L.DomUtil.create('button', 'custom-map-btn btn-okr', container);
                button.innerHTML = 'Okrƒôg√≥wka'; 
                L.DomEvent.on(button, 'click', function(e) { L.DomEvent.stopPropagation(e); toggleTable('okregowka'); });
                return container;
            }
        });

        L.Control.TableButtonAKlasa = L.Control.extend({
            onAdd: function(map) {
                var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
                var button = L.DomUtil.create('button', 'custom-map-btn btn-aklasa', container);
                button.innerHTML = 'A - Klasa'; 
                L.DomEvent.on(button, 'click', function(e) { L.DomEvent.stopPropagation(e); toggleTable('aklasa'); });
                return container;
            }
        });

        new L.Control.TableButtonOkr({ position: 'bottomleft' }).addTo(mymap);
        new L.Control.TableButtonAKlasa({ position: 'bottomleft' }).addTo(mymap);

		// Mierzenie trasy i wyszukiwarka (bez zmian)
		var isRoutingMode = false, routePoints = [], routingControl = null;
		function handleRouteClick(e) {
			var marker = e.target; marker.closePopup(); var latlng = marker.getLatLng();
			if (routePoints.length === 0) { if (routingControl) { mymap.removeControl(routingControl); } routePoints.push(latlng); alert("Punkt START wybrany. Wybierz cel."); } 
            else if (routePoints.length === 1) { routePoints.push(latlng); routingControl = L.Routing.control({ waypoints: routePoints, draggableWaypoints: false, show: true, lineOptions: { styles: [{color: 'blue', opacity: 0.6, weight: 6}] } }).addTo(mymap); routePoints = []; }
		}
		document.getElementById('btnTrasa').addEventListener('click', function() {
			isRoutingMode = !isRoutingMode;
			if (isRoutingMode) { this.innerHTML = "‚ùå Wy≈ÇƒÖcz mierzenie"; this.style.background = "#ffcccc"; document.getElementById('map').style.cursor = "crosshair"; markersList.forEach(m => m.on('click', handleRouteClick)); } 
            else { this.innerHTML = "üìè Zmierz trasƒô"; this.style.background = "white"; document.getElementById('map').style.cursor = ""; markersList.forEach(m => m.off('click', handleRouteClick)); if (routingControl) { mymap.removeControl(routingControl); routingControl = null; } routePoints = []; }
		});

		const searchInput = document.getElementById('search-input'), searchResults = document.getElementById('search-results');
		searchInput.addEventListener('input', function() {
			const query = this.value.toLowerCase(); searchResults.innerHTML = '';
			if (query.length < 2) { searchResults.style.display = 'none'; return; }
			const matches = clubs.map((club, index) => ({ data: club, originalIndex: index })).filter(item => item.data.name.toLowerCase().includes(query));
			if (matches.length > 0) {
				searchResults.style.display = 'block';
				matches.forEach(match => {
					const div = document.createElement('div'); div.className = 'search-result-item'; div.innerText = match.data.name;
					div.addEventListener('click', function() { searchInput.value = ''; searchResults.style.display = 'none'; mymap.setView(match.data.coords, 14); markersList[match.originalIndex].openPopup(); });
					searchResults.appendChild(div);
				});
			} else { searchResults.style.display = 'none'; }
		});
		document.addEventListener('click', function(e) { if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) { searchResults.style.display = 'none'; } });
    </script>    
</body>
</html>
